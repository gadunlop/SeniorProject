<!DOCTYPE html>
<html>

<head>
	<title>Senior Project Map</title>
</head>
	<style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
	
  <body>
    <div id="map"></div>
	<!-- Div created to store twitter descriptions, names, and profile pictures -->
	<div class="twitter"> 
		<div class="inside"></div>
	</div>
	<!-- Div created to display the last 5 tweets -->
	<div class="posts"></div>
	  
    <script>
	//Variables to create twitter markers, geocoder for setting the locations of tweets, ey, my, and mouseDown for mouse function
		var tweetMarker, geocoder, ey, my, mouseDown = false;
      	var map;
		var woodward = {lat: 35.307462, lng: -80.735690};
		var charlotte = {lat: 35.226553, lng: -80.837086};
		var NC = {lat:35.499266, lng: -78.606339};
		var marker = 0;

      function initMap() { 
	  
        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: 37.09024, lng: -95.712891},
          zoom: 5,
			
			//Styling for the map in UNCC colors
			styles: [
			  {
				"elementType": "labels",
				"stylers": [
				  {
					"visibility": "off"
				  }
				]
			  },
			  {
				"featureType": "administrative",
				"elementType": "geometry",
				"stylers": [
				  {
					"visibility": "off"
				  }
				]
			  },
			  {
				"featureType": "administrative.land_parcel",
				"stylers": [
				  {
					"visibility": "off"
				  }
				]
			  },
			  {
				"featureType": "administrative.neighborhood",
				"stylers": [
				  {
					"visibility": "off"
				  }
				]
			  },
			  {
				"featureType": "landscape.man_made",
				"elementType": "geometry.fill",
				"stylers": [
				  {
					"color": "#046a38"
				  }
				]
			  },
			  {
				"featureType": "landscape.natural",
				"elementType": "geometry.fill",
				"stylers": [
				  {
					"color": "#27251f"
				  }
				]
			  },
			  {
				"featureType": "poi",
				"stylers": [
				  {
					"visibility": "on"
				  }
				]
			  },
			  {
				"featureType": "road",
				"stylers": [
				  {
					"visibility": "on"
				  }
				]
			  },
			  {
				"featureType": "road",
				"elementType": "labels.icon",
				"stylers": [
				  {
					"visibility": "off"
				  }
				]
			  },
			  {
				"featureType": "transit",
				"stylers": [
				  {
					"visibility": "off"
				  }
				]
			  },
			  {
				"featureType": "water",
				"elementType": "geometry.fill",
				"stylers": [
				  {
					"color": "#b9975b"
				  }
				]
			  }
			]
		});


		//Polygon Data for United States, NC, Charlotte, UNCC, Woodward
		  var nationLayer = new google.maps.Data({map:map});
		  var stateLayer = new google.maps.Data({map:map});
		  var countyLayer = new google.maps.Data({map:map});
		  var schoolLayer = new google.maps.Data({map:map});
		  var woodwardLayer = new google.maps.Data({map:map});
		  
		//GEOJSON from Johan github
		  nationLayer.loadGeoJson('https://raw.githubusercontent.com/johan/world.geo.json/master/countries/USA.geo.json');
		  stateLayer.loadGeoJson('https://raw.githubusercontent.com/johan/world.geo.json/master/countries/USA/NC.geo.json');
		  countyLayer.loadGeoJson('charlotte_zoning_1.json');
		  schoolLayer.loadGeoJson('UNCC_geoJSON.json');
		  woodwardLayer.loadGeoJson('woodward_geoJSON.json')
		  
		//Styling for Polygon data
		  nationLayer.setStyle({
		  	fillColor: 'green',
			strokeColor: 'green',
		  	strokeWeight: 2,
			visible: true,
			clickable: true
		});
		  stateLayer.setStyle({
			visible: false,
			clickable: false
		});
		  countyLayer.setStyle({
			visible: false,
			clickable: false
		});
		  schoolLayer.setStyle({
			visible: false,
			clickable: false
		});
		  woodwardLayer.setStyle({
			visible: false,
			clickable: false
		});
		  
		//listener to call zoom in function from one polygon to another as a polygon is clicked
		  nationLayer.addListener('click', State);  
		  stateLayer.addListener('click', County);
		  countyLayer.addListener('click', School);
		  schoolLayer.addListener('click', Building);
		  
		  //nationLayer.addListener('dblclick', State);  
		  //stateLayer.addListener('dblclick', County);
		  map.addListener('click', function(){
			  if(marker == 1){Nation();}
			  if(marker == 2){State();}
			  if(marker == 3){County();}
			  if(marker == 4){School();}
		  });
		  schoolLayer.addListener('dblclick', County);

		//Functions navigating between the various levels (eg: nationState is from nation to state level)
		  function Nation(){
			  marker = 0;
			  nationLayer.setStyle({
				  fillColor: 'green',
				  strokeColor: 'green',
				  strokeWeight: 2,
				  visible: true,
				  clickable: true
			  });
			  stateLayer.setStyle({
				  visible: false
			  });
			  countyLayer.setStyle({
				 visible: false
			  });
			  schoolLayer.setStyle({
				  visible: false
			  });
			  map.setCenter({lat: 37.09024, lng: -95.712891});
			  map.setZoom(5);
		  }
		  function State(){
			  marker = 1;
			  stateLayer.setStyle({
				  fillColor: 'green',
				  strokeColor: 'green',
				  strokeWeight: 2,
				  visible: true,
				  clickable: true
			  });
			  nationLayer.setStyle({
				  visible: false
			  });
			  countyLayer.setStyle({
				 visible: false
			  });
			  schoolLayer.setStyle({
				  visible: false
			  });
			  map.setCenter({lat:35.499266, lng: -78.606339});
			  map.setZoom(7);
		  } 
		  function County(){
			  marker = 2;
			  countyLayer.setStyle({
					fillColor: 'green',
					strokeColor: 'green',
					strokeWeight: 1,
					visible: true,
					clickable: true
			  });
			  	nationLayer.setStyle({
				    visible: false
			  });
			  	stateLayer.setStyle({
				 	visible: false
			  });
			  schoolLayer.setStyle({
				  visible: false
			  });
			  map.setCenter({lat: 35.226553, lng: -80.837086});
			  map.setZoom(10);
			}
		  function School(){
			  marker = 3;
			  schoolLayer.setStyle({
				fillColor: 'green',
				strokeColor: 'red',
		  		strokeWeight: 3,
				visible: true,
				clickable: true
			  });
			  nationLayer.setStyle({
				  visible: false
			  });
			  stateLayer.setStyle({
				 	visible: false
			  });
			  countyLayer.setStyle({
				 visible: false
			  });	
			  map.setCenter({lat: 35.307462, lng: -80.735690});
			  map.setZoom(13);
		  }
		  function Building(){
			  marker = 4;
			  woodwardLayer.setStyle({
				fillColor: 'gold',
				strokeColor: 'red',
		  		strokeWeight: 3,
				visible: true,
				clickable: true
			  });
			  nationLayer.setStyle({
				  visible: false
			  });
			  stateLayer.setStyle({
				  visible: false
			  });
			  countyLayer.setStyle({
				 visible: false
			  });
			  schoolLayer.setStyle({
				  visible: false
			  });
			  map.setCenter( {lat: 35.307462, lng: -80.735690});
			  map.setZoom(16);
		  }
	  
		
	  //Object to create Tweets
	var o = {
	// init function  
		init: function(){
			this.twitter.show();
			this.twitter.click();
			this.scroll.init();
	  },
	 //Twitter function
		twitter: {
		get: function(){
			var arr = new Array;
			$('.get').find('input').each(function(i){
				var t = $(this), 
					val = t.val();
				arr[i] = val;				
			});
			return arr;
			},
		
	//'show' Tweet Function
		show: function(){
			var users = o.twitter.get(), arr = new Array;
			for (i in users){
				var user = users[i];
				$.getJSON('http://twitter.com/users/show/'+user+'.json?callback=?', function(data) {
					var img = data.profile_image_url,
						screen_name = data.screen_name;
					geocoder.geocode({ address: data.location }, function(response, status){
						if (status == google.maps.GeocoderStatus.OK) {
							var x = response[0].geometry.location.lat(),
								y = response[0].geometry.location.lng();
							tweetMarker = new google.maps.Marker({
								icon: img,
								map: map,
								title: screen_name,
								position: new google.maps.LatLng(x, y)
							});
							
							arr.push('<div class="item">');
							arr.push('<p class="img"><a href="#" class="open" rel="'+screen_name+'"><img src="'+img+'" alt="" /></a></p>');
							arr.push('<div class="entry">');
							arr.push('<a href="#" class="open title" rel="'+screen_name+'">'+data.name+'</a>');
							arr.push('<p class="description">'+data.description+'</p>');
							arr.push('<p class="url"><a href="'+data.url+'" target="_blank">'+data.url+'</a></p>');
							arr.push('<p class="count">Followers: '+data.followers_count+', Following: '+data.friends_count+'</p>');
							arr.push('</div>');
							arr.push('</div>');
							var html = arr.join('');
							arr = [];
							$('.twitter').find('.inside').append(html);
							google.maps.event.addListener(tweetMarker, 'click', function(){
								o.twitter.open(this.title);
							}); 
						}
					});
				});
			};
		),
		
		click: function(){
			$('.twitter').find('.open').live('click', function(){
				var t = $(this), rel = t.attr('rel');
				o.twitter.open(rel);
			});
		},
		
		open: function(user){
			var posts = $('.posts'), arr = new Array;
			$.getJSON('http://twitter.com/status/user_timeline/'+user+'.json?count=5&callback=?', function(data) {
				$.each(data, function(i, post){
					arr.push('<div class="post">');
					arr.push(post.text);
					arr.push('</div>');
				});
				var html = arr.join('');
				posts.html(html).fadeIn();
			});
		},
		//End of Twitter
		
		scroll: {
			mouse: function(e){
				var y = e.pageY; 
				return y;
			},
			check: function(y){
				var all = $('.twitter').height(),
					inside = $('.twitter').find('.inside').height();
				if (y < (all - inside)) {
					y = all - inside;
				} else if (y > 0) {
					y = 0;
				}
				return y;
			},
			update: function(e){
				var y = o.scroll.mouse(e),
					movey = y-my,
					top = ey+movey;
					check = o.scroll.check(top);
				$('.twitter').find('.inside').css({ top: check+'px' });
			},
			init: function(){
				$('.twitter').find('.inside').bind({
					mousedown: function(e){
						e.preventDefault();
						mouseDown = true;
						var mouse = o.scroll.mouse(e);
							my = mouse;
						var element = $(this).position();
							ey = element.top;
						o.scroll.update(e);
					},
					mousemove: function(e){
						if (mouseDown)
							o.scroll.update(e);
						return false;
					},
					mouseup: function(){
						if (mouseDown)
							mouseDown = false;
						return false;
					},
					mouseleave: function(){
						if (mouseDown)
							mouseDown = false;
						return false;
					}
				});
			}
		}
	}//End of object
}	
}
	$(function(){ o.init(); });
	
	
    </script>
	<script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js">
	</script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyApa2GOvUTjcDKfvQ04IHqvvk__TfFfOPI&callback=initMap"
    async defer></script>
</body>

</html>
